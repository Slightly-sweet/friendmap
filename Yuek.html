<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ˜Ÿç³»å¼•åŠ›å›¾</title>
    <!-- å¼•å…¥ D3.js å¯è§†åŒ–åº“ -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            background-color: #0b0c10; /* æ·±ç©ºé»‘ */
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
        }

        /* èƒŒæ™¯æ˜Ÿæ˜ŸåŠ¨ç”» */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        /* æ‚¬åœå¡ç‰‡æ ·å¼ (ç£¨ç ‚ç»ç’ƒç‰¹æ•ˆ) */
        #tooltip {
            position: absolute;
            opacity: 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 12px;
            pointer-events: none;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            max-width: 250px;
            transition: all 0.2s ease;
            transform: translate(-50%, -120%);
            z-index: 10;
        }

        #tooltip h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
            color: #66fcf1; /* éœ“è™¹è“æ ‡é¢˜ */
        }
        
        #tooltip .meta {
            font-size: 12px;
            color: #c5c6c7;
            margin-bottom: 8px;
        }

        #tooltip p {
            margin: 0;
            font-size: 13px;
            line-height: 1.5;
            color: #fff;
        }
    </style>
</head>
<body>

    <!-- æ‚¬æµ®æç¤ºæ¡† -->
    <div id="tooltip"></div>

    <script>
        // ==========================================
        // ğŸ‘‡ åœ¨è¿™é‡Œä¿®æ”¹ä½ çš„æœ‹å‹æ•°æ® ğŸ‘‡
        // ==========================================
        
        // è¿™é‡Œçš„é¡ºåºå†³å®šäº†æ‰‡åŒºçš„æ’åˆ—é¡ºåº
        const stages = ["å°å­¦", "åˆä¸­", "é«˜ä¸­", "å¤§å­¦", "ç ”ç©¶ç”Ÿ", "å®ä¹ /å·¥ä½œ"];

        const friendsData = [
            // æ ¼å¼ï¼š{ å§“å, é˜¶æ®µ, äº²å¯†è·ç¦»(è¶Šå°è¶Šè¿‘), æ˜¯å¦è”ç³»(true/false), æ€§åˆ«(ç”·/å¥³), æ•…äº‹ }
            
            // --- ç ”ç©¶ç”Ÿé˜¶æ®µ ---
            { name: "A", stage: "ç ”ç©¶ç”Ÿ", distance: 15, contact: true, gender: "å¥³", story: "ç ”ä¸€æœ€å´©æºƒçš„æ—¶å€™é™ªæˆ‘é€šå®µæ”¹è®ºæ–‡ï¼Œè¿˜ç»™æˆ‘ç…®é¢åƒã€‚" },
            { name: "B", stage: "ç ”ç©¶ç”Ÿ", distance: 40, contact: true, gender: "ç”·", story: "å¸¦æˆ‘å…¥é—¨å®éªŒå®¤çš„å¤§ç¥ï¼Œè™½ç„¶æ¯•ä¸šäº†ä½†ä¾ç„¶ä¼šæŒ‡å¯¼æˆ‘ã€‚" },

            // --- å¤§å­¦é˜¶æ®µ ---
            { name: "å°", stage: "å¤§å­¦", distance: 20, contact: true, gender: "å¥³", story: "å¤§å­¦å››å¹´çš„é¥­æ­å­ï¼Œä¹Ÿæ˜¯ä¹Ÿæ˜¯æˆ‘çš„æƒ…æ„Ÿåƒåœ¾æ¡¶ã€‚" },
            { name: "C", stage: "å¤§å­¦", distance: 60, contact: false, gender: "ç”·", story: "æ›¾ç»ä¸€èµ·åŠè¿‡æœ€å¤§çš„æ´»åŠ¨ï¼Œæ•™ä¼šæˆ‘ä»€ä¹ˆæ˜¯é¢†å¯¼åŠ›ã€‚" },

            // --- é«˜ä¸­é˜¶æ®µ ---
            { name: "D", stage: "é«˜ä¸­", distance: 30, contact: true, gender: "å¥³", story: "é‚£ä¸ªé™ªæˆ‘æ™šè‡ªä¹ é€ƒè¯¾çœ‹æ˜Ÿæ˜Ÿçš„äººï¼Œè™½ç„¶å¼‚åœ°ä½†å¿ƒå¾ˆè¿‘ã€‚" },
            { name: "è€ç­", stage: "é«˜ä¸­", distance: 80, contact: false, gender: "ç”·", story: "è™½ç„¶å¾ˆå‡¶ï¼Œä½†æ˜¯å”¯ä¸€ä¸€ä¸ªåŠæˆ‘ä¸è¦æ”¾å¼ƒæ•°å­¦çš„äººã€‚" },
            
            // --- å®ä¹ é˜¶æ®µ ---
            { name: "Mentor E", stage: "å®ä¹ /å·¥ä½œ", distance: 50, contact: true, gender: "å¥³", story: "æˆ‘çš„èŒåœºå¼•è·¯äººï¼Œéå¸¸æœ‰æ°”è´¨çš„å§å§ã€‚" },
            
             // --- åˆä¸­/å°å­¦ ---
            { name: "F", stage: "å°å­¦", distance: 10, contact: true, gender: "å¥³", story: "è®¤è¯†20å¹´äº†ï¼Œç”šè‡³ä¸éœ€è¦è¯´è¯å°±çŸ¥é“å¯¹æ–¹åœ¨æƒ³ä»€ä¹ˆã€‚" },
        ];

        // ==========================================
        // ğŸ‘† ä¿®æ”¹ç»“æŸï¼Œä¸‹é¢æ˜¯ç”Ÿæˆé€»è¾‘ï¼Œæ— éœ€ä¿®æ”¹ ğŸ‘†
        // ==========================================

        // 1. åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
        function createStars() {
            for(let i=0; i<100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 100 + 'vh';
                star.style.animationDuration = (Math.random() * 3 + 1) + 's';
                document.body.appendChild(star);
            }
        }
        createStars();

        // 2. è®¾ç½®ç”»å¸ƒå°ºå¯¸
        const width = window.innerWidth;
        const height = window.innerHeight;
        const centerX = width / 2;
        const centerY = height / 2;
        // åŠå¾„ï¼šç•™å‡ºä¸€äº›è¾¹è·
        const maxRadius = Math.min(width, height) / 2 - 80; 

        // åˆ›å»º SVG å®¹å™¨
        const svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", `translate(${centerX},${centerY})`);

        // 3. å®šä¹‰æ¯”ä¾‹å°º
        // è§’åº¦æ¯”ä¾‹å°ºï¼šæŠŠé˜¶æ®µæ˜ å°„åˆ°è§’åº¦ (0 åˆ° 2*PI)
        const angleScale = d3.scaleBand()
            .domain(stages)
            .range([0, 2 * Math.PI])
            .align(0);

        // åŠå¾„æ¯”ä¾‹å°ºï¼šæŠŠäº²å¯†åº¦(0-100)æ˜ å°„åˆ°åƒç´ è·ç¦»
        // 0æ˜¯åœ†å¿ƒï¼Œ100æ˜¯è¾¹ç¼˜
        const radiusScale = d3.scaleLinear()
            .domain([0, 100])
            .range([50, maxRadius]); // 50æ˜¯ä¸ºäº†ä¸å’Œä¸­é—´çš„â€œæˆ‘â€é‡å 

        // é¢œè‰²æ˜ å°„
        const colorScale = (gender) => gender === "å¥³" ? "#ff4d94" : "#00d2ff";

        // 4. å®šä¹‰å‘å…‰æ»¤é•œ (Glow Filter)
        const defs = svg.append("defs");
        const filter = defs.append("filter")
            .attr("id", "glow");
        filter.append("feGaussianBlur")
            .attr("stdDeviation", "2.5")
            .attr("result", "coloredBlur");
        const feMerge = filter.append("feMerge");
        feMerge.append("feMergeNode").attr("in", "coloredBlur");
        feMerge.append("feMergeNode").attr("in", "SourceGraphic");

        // 5. ç»˜åˆ¶æ‰‡åŒºè¾…åŠ©çº¿å’Œæ ‡ç­¾
        stages.forEach(stage => {
            const angle = angleScale(stage) + angleScale.bandwidth() / 2; // æ‰‡åŒºä¸­å¿ƒè§’åº¦
            const labelRadius = maxRadius + 30;
            
            // è½¬æ¢æåæ ‡åˆ°ç¬›å¡å°”åæ ‡
            const x = Math.sin(angle) * maxRadius;
            const y = -Math.cos(angle) * maxRadius;
            const labelX = Math.sin(angle) * labelRadius;
            const labelY = -Math.cos(angle) * labelRadius;

            // ç”»åˆ†å‰²è™šçº¿ (å¯é€‰ï¼Œåƒè‰å›¾é‚£æ ·)
            // è¿™é‡Œæˆ‘ä»¬ç”»æ‰‡åŒºçš„è¾¹ç•Œçº¿
            const startAngle = angleScale(stage);
            const lineX = Math.sin(startAngle) * maxRadius;
            const lineY = -Math.cos(startAngle) * maxRadius;
            
            svg.append("line")
                .attr("x1", 0)
                .attr("y1", 0)
                .attr("x2", lineX)
                .attr("y2", lineY)
                .attr("stroke", "rgba(255,255,255,0.1)")
                .attr("stroke-dasharray", "4,4");

            // æ·»åŠ é˜¶æ®µæ–‡å­—æ ‡ç­¾
            svg.append("text")
                .attr("x", labelX)
                .attr("y", labelY)
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .attr("fill", "#888")
                .attr("font-size", "14px")
                .text(stage);
        });

        // 6. ç»˜åˆ¶åœ†å¿ƒï¼ˆæˆ‘ï¼‰
        svg.append("circle")
            .attr("r", 15)
            .attr("fill", "#ffd700") // é‡‘è‰²
            .style("filter", "url(#glow)")
            .style("cursor", "pointer");
        
        svg.append("text")
            .attr("y", 35)
            .attr("text-anchor", "middle")
            .attr("fill", "#ffd700")
            .attr("font-size", "12px")
            .text("æˆ‘");

        // 7. å¤„ç†æ•°æ®ä½ç½®
        // ä¸ºäº†é˜²æ­¢ç‚¹é‡å ï¼Œæˆ‘ä»¬åœ¨è®¡ç®—è§’åº¦æ—¶ï¼ŒåŠ ä¸Šä¸€ç‚¹éšæœºåç§»é‡
        const processedData = friendsData.map(d => {
            const bandwidth = angleScale.bandwidth();
            const startAngle = angleScale(d.stage);
            // åœ¨æ‰‡åŒºèŒƒå›´å†…éšæœºåç§»ï¼Œä¿ç•™ä¸¤è¾¹è¾¹è·
            const randomOffset = Math.random() * (bandwidth * 0.6) + (bandwidth * 0.2); 
            const angle = startAngle + randomOffset;
            const r = radiusScale(d.distance);

            return {
                ...d,
                x: Math.sin(angle) * r,
                y: -Math.cos(angle) * r
            };
        });

        // 8. ç»˜åˆ¶è¿çº¿
        svg.selectAll(".link")
            .data(processedData)
            .enter()
            .append("line")
            .attr("x1", 0)
            .attr("y1", 0)
            .attr("x2", d => d.x)
            .attr("y2", d => d.y)
            .attr("stroke", d => colorScale(d.gender))
            .attr("stroke-width", 1)
            .attr("opacity", 0.4)
            // å¦‚æœè”ç³»ä¸ºtrueåˆ™å®çº¿ï¼Œå¦åˆ™è™šçº¿
            .attr("stroke-dasharray", d => d.contact ? "0" : "4,4");

        // 9. ç»˜åˆ¶æœ‹å‹èŠ‚ç‚¹ï¼ˆæ˜Ÿçƒï¼‰
        const nodes = svg.selectAll(".node")
            .data(processedData)
            .enter()
            .append("circle")
            .attr("cx", d => d.x)
            .attr("cy", d => d.y)
            .attr("r", d => d.distance < 20 ? 12 : 8) // è¶Šè¿‘çš„çƒè¶Šå¤§
            .attr("fill", d => colorScale(d.gender))
            .style("filter", "url(#glow)")
            .style("cursor", "pointer")
            .style("opacity", 0.9);

        // 10. äº¤äº’é€»è¾‘ (Tooltip)
        const tooltip = d3.select("#tooltip");

        nodes.on("mouseover", function(event, d) {
            // æ”¾å¤§æ•ˆæœ
            d3.select(this).transition().duration(200).attr("r", d.distance < 20 ? 16 : 12);
            
            // æ˜¾ç¤ºTooltip
            tooltip.style("opacity", 1)
                .style("left", (event.pageX) + "px")
                .style("top", (event.pageY) + "px")
                .html(`
                    <h3>${d.name}</h3>
                    <div class="meta">${d.stage} Â· ${d.gender} Â· ${d.contact ? "ä¿æŒè”ç³»" : "æš‚æ— è”ç³»"}</div>
                    <p>â€œ${d.story}â€</p>
                `);
        })
        .on("mouseout", function(event, d) {
            // æ¢å¤å¤§å°
            d3.select(this).transition().duration(200).attr("r", d.distance < 20 ? 12 : 8);
            
            // éšè—Tooltip
            tooltip.style("opacity", 0);
        });

        // æ·»åŠ ç®€å•çš„å…¥åœºåŠ¨ç”»
        nodes.attr("r", 0)
             .transition()
             .duration(1000)
             .attr("r", d => d.distance < 20 ? 12 : 8);

    </script>
</body>
</html>
